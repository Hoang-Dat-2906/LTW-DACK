@model DACK.Models.Product

@{
    ViewData["Title"] = Model.ProductName;
}
<style>
    .detail-img-box {
        width: 120px;
        height: 120px;
        border: 1px solid #ddd;
        overflow: hidden;
        border-radius: 6px;
    }
    /* ===== PRODUCT DETAIL GALLERY ===== */

    .product-detail-gallery {
        display: flex;
        gap: 12px;
        flex-wrap: nowrap;
    }

    .detail-img-box {
        width: 100px;
        height: 100px;
        border: 1px solid #ddd;
        border-radius: 6px;
        overflow: hidden;
        cursor: pointer;
        background: #fff;
    }

        .detail-img-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .detail-img-box:hover {
            border-color: #000;
            transform: scale(1.05);
            transition: all 0.2s ease;
        }
    /* Tab Header Styling */
    .nav-tabs .nav-link {
        color: #111;
        font-weight: 600;
        text-transform: uppercase;
        border: none;
    }

        .nav-tabs .nav-link.active {
            color: #ca1515 !important;
            border-bottom: 2px solid #ca1515;
        }

    /* Review Item Styling */
    .review-item {
        border-radius: 8px;
        transition: transform 0.2s;
    }

        .review-item:hover {
            border-color: #ca1515 !important;
        }

    .admin-reply {
        border-radius: 0 4px 4px 0;
    }

    .text-warning .fa-star {
        color: #f39c12;
    }

    .text-warning .fa-star-o {
        color: #ccc;
    }
</style>

<section class="shop-details spad">
    <div class="container">
        <div class="row">

            <!-- LEFT: IMAGE -->
            <div class="col-lg-6">
                @{
                    var allImages = Model.ProductImage
                        .OrderByDescending(x => x.IsPrimary) // main lên đầu
                        .ThenBy(x => x.SortOrder)
                        .ToList();

                    var mainImage = allImages.FirstOrDefault();
                }


                <img id="mainImage"
                     class="img-fluid mb-3"
                     src="~/assets/img/product/@mainImage.ImageUrl"
                     alt="@Model.ProductName" />


                @if (allImages.Any())
                {
                    <div class="product-detail-gallery mt-3">
                        @foreach (var img in allImages)
                        {
                            var isActive = img.ImageUrl == mainImage.ImageUrl;

                            <div class="detail-img-box @(isActive ? "active" : "")">
                                <img src="~/assets/img/product/@img.ImageUrl"
                                     alt="@Model.ProductName" />
                            </div>
                        }
                    </div>
                }



            </div>

            <!-- RIGHT: INFO -->
            <div class="col-lg-6">
                <h3 class="fw-bold">@Model.ProductName</h3>

                <h4 class="text-danger mb-3">
                    @Model.BasePrice.ToString("#,##0") đ
                </h4>
                <form method="post" action="/Cart/AddToCart">

                    <input type="hidden" name="ProductId" value="@Model.ProductId" />

                    <!-- SIZE + QUANTITY -->
                    <div class="d-flex align-items-center gap-3 mb-4">
                        <div style="min-width: 120px;">
                            <label class="fw-bold d-block mb-1">Size</label>
                            <select name="SizeId" class="form-select border-dark">
                                @foreach (var v in Model.ProductVariant.Select(x => x.Size).Distinct())
                                {
                                    <option value="@v.SizeId">@v.SizeCode</option>
                                }
                            </select>
                        </div>

                        <div style="min-width: 100px;">
                            <label class="fw-bold d-block mb-1">Số lượng</label>
                            <div class="input-group border-dark">
                                <input type="number" name="Quantity" class="form-control text-center" value="1" min="1" max="10">
                            </div>
                        </div>
                    </div>

                    <!-- MESSAGE -->
                    <div class="mb-3">
                        <label class="fw-semibold">Ghi chú</label>
                        <input type="text"
                               name="Message"
                               class="form-control"
                               placeholder="Ghi chú cho bài người bán" />
                    </div>

                    <!-- BUTTON -->
                    <button class="btn btn-dark w-100 py-2">
                        Thêm vào giỏ
                    </button>
                </form>
            </div>
        </div>

        <!-- DESCRIPTION -->
        <div class="row mt-5">
            <div class="col-lg-12">
                <h5 class="fw-bold">Mô tả</h5>
                <p>@Model.Description</p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="product__details__tab">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#tabs-5"
                               role="tab">Description</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#tabs-6" role="tab">
                                Customer
                                Previews(5)
                            </a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tabs-5" role="tabpanel">
                            <div class="product__details__tab__content">
                                <p class="note">
                                    
                                </p>
                                <div class="product__details__tab__content__item">
                                    <h5>Giới thiệu sản phẩm</h5>
                                    <p>
                                        Chiếc quần short jean này là sự lựa chọn hoàn hảo cho những chàng trai yêu thích phong cách năng động và phóng khoáng. Với thiết kế hiện đại, form dáng vừa vặn giúp tôn lên vẻ ngoài trẻ trung nhưng vẫn đảm bảo sự thoải mái tuyệt đối cho người mặc trong mọi hoạt động hàng ngày. Điểm nhấn của sản phẩm nằm ở những đường wash màu tinh tế cùng đường kim mũi chỉ chắc chắn, mang đến một vẻ đẹp bụi bặm nhưng không kém phần chỉn chu. Dù là kết hợp cùng áo thun đơn giản để dạo phố hay phối cùng sơ mi cho những buổi gặp gỡ bạn bè, chiếc quần này vẫn giúp bạn khẳng định gu thời trang cá tính và hiện đại của mình.
                                    </p>
                                    <p>
                                        Sản phẩm được chế tác từ dòng vải Denim cao cấp với sự kết hợp hoàn hảo giữa sợi Cotton tự nhiên và sợi co giãn Spandex. Chất liệu Cotton giúp bề mặt vải có độ bền cao, khả năng thấm hút mồ hôi cực tốt và cực kỳ thoáng mát, phù hợp với khí hậu nóng ẩm. Việc pha thêm sợi co giãn giúp chiếc quần có độ đàn hồi linh hoạt, không gây cảm giác gò bó khi vận động mạnh hay ngồi lâu. Đặc biệt, vải đã trải qua quy trình xử lý công nghệ cao giúp bề mặt mềm mại hơn, hạn chế tối đa tình trạng nhăn nhúm hay phai màu sau nhiều lần giặt, giữ cho sản phẩm luôn trông như mới.
                                    </p>
                                </div>
                                <div class="product__details__tab__content__item">
                                    <h5>Chất liệu sử dụng</h5>
                                    <p>
                                        Sản phẩm được chế tác từ dòng vải Denim cao cấp với sự kết hợp hoàn hảo giữa sợi Cotton tự nhiên và sợi co giãn Spandex. Chất liệu Cotton giúp bề mặt vải có độ bền cao, khả năng thấm hút mồ hôi cực tốt và cực kỳ thoáng mát, phù hợp với khí hậu nóng ẩm. Việc pha thêm sợi co giãn giúp chiếc quần có độ đàn hồi linh hoạt, không gây cảm giác gò bó khi vận động mạnh hay ngồi lâu. Đặc biệt, vải đã trải qua quy trình xử lý công nghệ cao giúp bề mặt mềm mại hơn, hạn chế tối đa tình trạng nhăn nhúm hay phai màu sau nhiều lần giặt, giữ cho sản phẩm luôn trông như mới.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="tabs-6" role="tabpanel">
                            <div class="product__details__tab__content">
                                <div class="product__details__tab__content__item">
                                    <h4 class="fw-bold mb-4 text-uppercase">Khách hàng nhận xét</h4>

                                    @if (ViewBag.Reviews != null && ((IEnumerable<dynamic>)ViewBag.Reviews).Any())
                                    {
                                        foreach (var rev in ViewBag.Reviews)
                                        {
                                            <div class="review-item mb-4 p-3 bg-light rounded shadow-sm border">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span class="fw-bold text-dark">@rev.FullName</span>
                                                        <span class="text-muted ms-2" style="font-size: 12px;">
                                                            <i class="fa fa-calendar"></i> @rev.CreatedAt.ToString("dd/MM/yyyy")
                                                        </span>
                                                    </div>
                                                    <div class="text-warning">
                                                        @for (int i = 1; i <= 5; i++)
                                                        {
                                                            <i class="fa @(i <= rev.Rating ? "fa-star" : "fa-star-o")"></i>
                                                        }
                                                    </div>
                                                </div>

                                                <div class="mt-2 text-secondary" style="font-size: 13px;">
                                                    Phân loại: <strong>Size @rev.SizeName, Màu @rev.ColorName</strong>
                                                </div>

                                                <p class="mt-2 mb-0 text-dark" style="font-style: italic;">"@rev.Comment"</p>

                                                <div class="admin-reply mt-3 p-3 bg-white border-start border-4 border-warning shadow-sm">
                                                    <span class="fw-bold text-warning" style="font-size: 13px;">
                                                        <i class="fa fa-user-circle"></i> Đội ngũ hỗ trợ phản hồi:
                                                    </span>
                                                    <p class="mb-0 mt-1 text-muted" style="font-size: 14px;">
                                                        Chào @rev.FullName, cảm ơn bạn đã tin tưởng lựa chọn sản phẩm của shop. Chúc bạn có những trải nghiệm tuyệt vời nhất!
                                                    </p>
                                                </div>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="text-center py-5">
                                            <i class="fa fa-comments-o fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">Sản phẩm này chưa có đánh giá nào. Hãy là người đầu tiên mua và nhận xét!</p>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
</section>


<script>
    document.querySelectorAll('.detail-img-box img').forEach(img => {
        img.addEventListener('click', function () {
            const mainImg = document.getElementById('mainImage');
            mainImg.src = this.src;

            document.querySelectorAll('.detail-img-box')
                .forEach(box => box.classList.remove('active'));

            this.parentElement.classList.add('active');
        });
    });
</script>

@*<h2>Details</h2>

    <div>
        <h4>Product</h4>
        <hr />
        <dl class="dl-horizontal">
            <dt>
                @Html.DisplayNameFor(model => model.SKU)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.SKU)
            </dd>

            <dt>
                @Html.DisplayNameFor(model => model.ProductName)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.ProductName)
            </dd>

            <dt>
                @Html.DisplayNameFor(model => model.Slug)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.Slug)
            </dd>

            <dt>
                @Html.DisplayNameFor(model => model.Description)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.Description)
            </dd>

            <dt>
                @Html.DisplayNameFor(model => model.BasePrice)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.BasePrice)
            </dd>

            <dt>
                @Html.DisplayNameFor(model => model.IsActive)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.IsActive)
            </dd>

            <dt>
                @Html.DisplayNameFor(model => model.CreatedAt)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.CreatedAt)
            </dd>

        </dl>
    </div>
    <p>
        @Html.ActionLink("Edit", "Edit", new { id = Model.ProductId }) |
        @Html.ActionLink("Back to List", "Index")
    </p>*@
